<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mark's Casino</title>
    <style>
        /* --- General Modern Styling --- */
        :root {
            /* Mark's Casino Palette */
            --color-primary: #FFD700; /* Gold */
            --color-secondary: #00bcd4; /* Accent Blue (for interactive elements) */
            --color-background: #1c1c1c; /* Dark Gray Background */
            --color-surface: #2a2a2a; /* Slightly lighter surface for containers */
            --color-text: #f0f0f0; /* Off-white text */
            --color-shadow: rgba(0, 0, 0, 0.7);
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: var(--color-background); 
            color: var(--color-text); 
            padding: 20px; 
            text-align: center;
        }
        
        /* --- HEADER & BALANCE --- */
        h1 { 
            color: var(--color-primary); 
            margin-bottom: 30px; 
            font-size: 3.5em;
            letter-spacing: 4px;
            text-shadow: 0 4px 6px var(--color-shadow);
        }
        
        .balance { 
            font-size: 1.6em; 
            margin-bottom: 40px; 
            padding: 15px 35px; 
            border: 2px solid var(--color-primary); 
            background: linear-gradient(145deg, var(--color-surface), #1a1a1a); 
            border-radius: 15px; 
            display: inline-block;
            box-shadow: 0 6px 20px var(--color-shadow);
        }

        /* --- GAME CONTAINER --- */
        .game-container { 
            background-color: var(--color-surface); 
            padding: 30px; 
            margin: 25px auto; 
            border-radius: 15px; 
            box-shadow: 0 5px 15px var(--color-shadow);
            max-width: 800px;
            border-top: 5px solid var(--color-primary); 
            transition: box-shadow 0.3s ease, transform 0.3s ease;
            text-align: left;
        }
        .game-container:hover {
            box-shadow: 0 10px 30px var(--color-shadow);
            transform: translateY(-3px);
        }
        
        h2 { 
            color: var(--color-primary); 
            border-bottom: 1px solid #444; 
            padding-bottom: 15px; 
            margin-bottom: 25px; 
            font-size: 2em;
            font-weight: 300; 
            text-align: center;
        }
        
        /* --- Hand Label Style --- */
        .hand-label {
            color: var(--color-secondary); 
            font-weight: 600; 
            font-size: 1.1em;
            margin-right: 8px;
        }

        /* --- Form Elements and Buttons --- */
        .game-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            padding-top: 15px;
        }
        .game-controls label {
            margin-right: 10px;
        }
        
        input[type="number"], select { 
            padding: 12px; 
            margin-right: 15px; 
            border: 1px solid #444; 
            border-radius: 8px; 
            width: 140px;
            background-color: #333;
            color: var(--color-text);
            outline: none;
            transition: border-color 0.2s;
        }
        input[type="number"]:focus, select:focus {
            border-color: var(--color-secondary);
        }
        button { 
            padding: 12px 25px; 
            background-color: var(--color-primary); 
            color: #121212; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 1em; 
            font-weight: bold;
            transition: all 0.2s ease;
            box-shadow: 0 4px #b8a032; /* Darker Gold for 3D effect */
            margin: 5px;
        }
        button:hover { 
            background-color: #e6c300; 
        }
        button:active { 
            transform: translateY(2px);
            box-shadow: 0 2px #b8a032;
        }
        button:disabled {
            background-color: #444;
            box-shadow: 0 4px #333;
            cursor: not-allowed;
            color: #777;
        }
        
        /* --- Result Feedback --- */
        .result { 
            margin-top: 25px; 
            font-weight: bold; 
            padding: 15px; 
            border-radius: 10px; 
            font-size: 1.3em;
            opacity: 0; 
            transition: opacity 0.5s ease-in-out;
            text-align: center;
        }
        .result.show { opacity: 1; }
        .win { background-color: #4caf50; color: white; border: 1px solid #81c784; }
        .lose { background-color: #f44336; color: white; border: 1px solid #e57373; }
        .push { background-color: #ff9800; color: #121212; border: 1px solid #ffb74d; }

        /* --- Slot Machine Specific --- */
        .slot-reels { display: flex; justify-content: center; gap: 20px; margin-bottom: 30px; }
        .reel { 
            font-size: 3.5em; 
            padding: 15px; 
            background-color: #0d0d0d; 
            border: 2px solid var(--color-primary); 
            border-radius: 8px; 
            width: 80px; 
            height: 80px;
            line-height: 80px; 
            overflow: hidden; 
            position: relative; 
            text-align: center;
        }
        .spinning .slot-symbol { animation: spin-animation 0.1s linear infinite; }
        @keyframes spin-animation {
            0% { transform: translateY(0); }
            100% { transform: translateY(-100%); }
        }

        /* --- Poker & Blackjack Cards --- */
        .hand-display { 
            display: flex; 
            justify-content: center; 
            gap: 10px; 
            margin-top: 15px; 
            margin-bottom: 25px;
            min-height: 70px; 
            flex-wrap: wrap; 
            align-items: center; 
            text-align: center;
        }
        .card { 
            padding: 15px 10px; 
            width: 50px;
            border: 1px solid #777; 
            background-color: #ffffff; 
            border-radius: 8px;
            color: black;
            font-size: 1.3em;
            box-shadow: 0 3px 6px var(--color-shadow);
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); 
            transform: translateY(20px) scale(0.9); 
            opacity: 0;
            text-align: center;
        }
        .card.dealt {
            transform: translateY(0) scale(1);
            opacity: 1;
        }
        .card.hidden {
            background-color: #555;
            color: #555;
            border-color: #333;
            box-shadow: none;
            cursor: help;
        }

        /* --- ROULETTE ANIMATION STYLING --- */
        .roulette-display-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px auto;
        }
        #rouletteReel {
            width: 150px;
            height: 50px; 
            border: 3px solid var(--color-primary);
            border-radius: 5px;
            overflow: hidden;
            position: relative;
            background-color: #0d0d0d;
            box-shadow: inset 0 0 10px var(--color-shadow);
        }
        .reel-segment {
            height: 50px; 
            line-height: 50px;
            font-size: 1.5em;
            font-weight: bold;
            color: white;
            transition: background-color 0.2s;
            text-align: center;
        }
        .red-bg { background-color: #cc0000; } /* Darker Red */
        .black-bg { background-color: #000000; } /* True Black */

        @keyframes roulette-spin {
            0% { transform: translateY(0); }
            100% { transform: translateY(-1200%); } 
        }
        
        .spinning-effect {
            animation: roulette-spin 0.05s linear infinite; 
        }

        #rouletteReelContent {
            display: flex;
            flex-direction: column;
            width: 100%;
            transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); 
        }
        
        #rouletteOutput {
            font-size: 1.2em;
            margin-left: 15px;
            min-width: 150px; 
            font-weight: bold;
            color: var(--color-primary);
        }
    </style>
</head>
<body>

    <h1>üí∞ Mark's Casino üí∞</h1>

    <div class="balance">
        Current Balance: <span id="balance">1000</span> Credits
    </div>

    <div class="game-container">
        <h2>Blackjack 21 ‚ô†Ô∏è</h2>
        <div class="hand-display">
            <span class="hand-label">Dealer Hand</span> (<span id="dealerScore">--</span>): <span id="dealerHand">--</span>
        </div>
        <div class="hand-display">
            <span class="hand-label">Your Hand</span> (<span id="playerScore">--</span>): <span id="playerHand">--</span>
        </div>
        <div class="game-controls">
            <label for="blackjackBet">Bet Amount:</label>
            <input type="number" id="blackjackBet" value="100" min="10">
            <button id="dealButton" onclick="dealBlackjack()">Deal</button>
            <button id="hitButton" onclick="hit()" disabled>Hit</button>
            <button id="standButton" onclick="stand()" disabled>Stand</button>
        </div>
        <div id="blackjackResult" class="result"></div>
    </div>

    ---

    <div class="game-container">
        <h2>Lucky Slots üé∞</h2>
        <div class="slot-reels">
            <span id="reel1" class="reel"><span class="slot-symbol">?</span></span>
            <span id="reel2" class="reel"><span class="slot-symbol">?</span></span>
            <span id="reel3" class="reel"><span class="slot-symbol">?</span></span>
        </div>
        <div class="game-controls">
            <label for="slotBet">Bet Amount:</label>
            <input type="number" id="slotBet" value="100" min="10">
            <button id="slotButton" onclick="playSlots()">Spin Reels</button>
        </div>
        <div id="slotResult" class="result"></div>
    </div>

    ---

    <div class="game-container">
        <h2>Grand Roulette (1-12) üî¥‚ö´</h2>
        <div class="roulette-display-container">
            <div id="rouletteReel">
                <div id="rouletteReelContent"></div>
            </div>
            <p id="rouletteOutput">Waiting for spin...</p>
        </div>
        <div class="game-controls">
            <label for="rouletteBet">Bet Amount:</label>
            <input type="number" id="rouletteBet" value="100" min="10">
            <select id="rouletteSelection">
                <option value="red">Red (1-6) - 2x</option>
                <option value="black">Black (7-12) - 2x</option>
                <option value="odd">Odd - 2x</option>
                <option value="even">Even - 2x</option>
                <option value="1">Number 1 - 10x</option>
                <option value="7">Number 7 - 10x</option>
            </select>
            <button id="rouletteButton" onclick="playRoulette()">Spin Wheel</button>
        </div>
        <div id="rouletteResult" class="result"></div>
    </div>

    ---

    <div class="game-container">
        <h2>Classic 5-Card Draw Poker üÉè</h2>
        <p style="text-align:center;">Goal: Beat the Dealer's hand rank!</p>
        <div class="hand-display" id="playerPokerHand"><span class="hand-label">Your Hand</span>: --</div>
        <div class="hand-display" id="dealerPokerHand"><span class="hand-label">Dealer Hand</span>: --</div>
        <div class="game-controls">
            <label for="pokerBet">Bet Amount:</label>
            <input type="number" id="pokerBet" value="100" min="10">
            <button id="pokerButton" onclick="playPoker()">Deal Cards</button>
        </div>
        <div id="pokerResult" class="result"></div>
    </div>

    <script>
        let balance = 1000;
        const balanceDisplay = document.getElementById('balance');
        const suits = ['‚ô†Ô∏è', '‚ô•Ô∏è', '‚ô¶Ô∏è', '‚ô£Ô∏è'];
        const cardValues = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
        
        // Map card values to numerical ranks for sorting and straight checking
        const rankMap = { '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10, 'J': 11, 'Q': 12, 'K': 13, 'A': 14 };


        function updateBalance(amount) {
            balance += amount;
            balanceDisplay.textContent = balance.toLocaleString();
            if (balance < 10) {
                document.querySelectorAll('button').forEach(btn => btn.disabled = true);
                balanceDisplay.textContent += " (OUT OF CREDITS! Refresh to restart)";
            } else {
                 document.querySelectorAll('button').forEach(btn => btn.disabled = false);
            }
        }

        function showResult(div, message, type) {
            message = message.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            div.innerHTML = message;
            div.className = `result ${type} show`;
            setTimeout(() => {
                div.classList.remove('show');
            }, 5000); 
        }

        function disableButtons(disabled) {
            document.getElementById('slotButton').disabled = disabled;
            document.getElementById('rouletteButton').disabled = disabled;
            document.getElementById('pokerButton').disabled = disabled;
            document.getElementById('dealButton').disabled = disabled;
        }

        function createDeck() {
            const deck = [];
            for (const suit of suits) {
                for (const value of cardValues) {
                    let rank = rankMap[value] || 10;
                    // For Blackjack, Aces are initially 11, adjusted later. For Poker, they are 14 (high).
                    let blackjackRank = (value === 'A') ? 11 : rank; 
                    deck.push({ value: value, suit: suit, rank: rank, blackjackRank: blackjackRank });
                }
            }
            return deck;
        }

        function dealCard(deck) {
            const randomIndex = Math.floor(Math.random() * deck.length);
            return deck.splice(randomIndex, 1)[0];
        }

        // --- 1. BLACKJACK LOGIC (Reusing blackjackRank from card object) ---
        let blackjackDeck = [];
        let playerHand = [];
        let dealerHand = [];

        function getScore(hand) {
            let score = hand.reduce((sum, card) => sum + card.blackjackRank, 0);
            let aces = hand.filter(card => card.value === 'A').length;
            while (score > 21 && aces > 0) {
                score -= 10;
                aces--;
            }
            return score;
        }
        // ... (rest of Blackjack logic: renderHands, dealBlackjack, hit, stand) ...

        function renderHands(hideDealerSecondCard = false) {
            const playerDiv = document.getElementById('playerHand');
            const dealerDiv = document.getElementById('dealerHand');
            const playerScoreSpan = document.getElementById('playerScore');
            const dealerScoreSpan = document.getElementById('dealerScore');

            playerDiv.innerHTML = '';
            dealerDiv.innerHTML = '';

            // Render Player Hand
            playerHand.forEach(card => {
                const pCard = document.createElement('span');
                pCard.className = 'card dealt';
                pCard.style.color = (card.suit === '‚ô•Ô∏è' || card.suit === '‚ô¶Ô∏è') ? 'red' : 'black';
                pCard.textContent = `${card.value}${card.suit}`;
                playerDiv.appendChild(pCard);
            });
            playerScoreSpan.textContent = getScore(playerHand);

            // Render Dealer Hand
            dealerHand.forEach((card, index) => {
                const dCard = document.createElement('span');
                dCard.className = 'card dealt';
                
                if (hideDealerSecondCard && index === 1) {
                    dCard.classList.add('hidden');
                    dCard.textContent = 'üÉè';
                    dealerScoreSpan.textContent = getScore([dealerHand[0]]);
                } else {
                    dCard.style.color = (card.suit === '‚ô•Ô∏è' || card.suit === '‚ô¶Ô∏è') ? 'red' : 'black';
                    dCard.textContent = `${card.value}${card.suit}`;
                    dealerScoreSpan.textContent = getScore(dealerHand);
                }
                dealerDiv.appendChild(dCard);
            });
        }

        async function dealBlackjack() {
            const betInput = document.getElementById('blackjackBet');
            const bet = parseInt(betInput.value);
            const resultDiv = document.getElementById('blackjackResult');

            if (bet > balance || bet <= 0) {
                showResult(resultDiv, 'Invalid bet or insufficient balance!', 'lose');
                return;
            }
            disableButtons(true);
            document.getElementById('hitButton').disabled = true;
            document.getElementById('standButton').disabled = true;
            updateBalance(-bet);

            blackjackDeck = createDeck();
            playerHand = [];
            dealerHand = [];
            resultDiv.classList.remove('show');
            document.getElementById('playerHand').innerHTML = '--';
            document.getElementById('dealerHand').innerHTML = '--';

            // Deal 2 cards to player, 2 to dealer
            for (let i = 0; i < 2; i++) {
                playerHand.push(dealCard(blackjackDeck));
                dealerHand.push(dealCard(blackjackDeck));
                renderHands(true);
                await new Promise(resolve => setTimeout(resolve, 300));
            }
            
            disableButtons(false);
            document.getElementById('dealButton').disabled = true;

            if (getScore(playerHand) === 21) {
                showResult(resultDiv, '<strong>BLACKJACK!</strong> Waiting for Dealer...', 'win');
                await stand(true);
            } else {
                document.getElementById('hitButton').disabled = false;
                document.getElementById('standButton').disabled = false;
            }
        }

        async function hit() {
            disableButtons(true);
            playerHand.push(dealCard(blackjackDeck));
            renderHands(true);
            await new Promise(resolve => setTimeout(resolve, 500)); 

            const score = getScore(playerHand);
            if (score > 21) {
                showResult(document.getElementById('blackjackResult'), `<strong>BUST!</strong> Score: ${score}. You lose.`, 'lose');
                disableButtons(false);
                document.getElementById('dealButton').disabled = false;
            } else if (score === 21) {
                showResult(document.getElementById('blackjackResult'), `<strong>21!</strong> Waiting for Dealer...`, 'win');
                await stand(true);
            } else {
                disableButtons(false);
                document.getElementById('dealButton').disabled = true;
            }
        }

        async function stand(auto = false) {
            disableButtons(true);
            const bet = parseInt(document.getElementById('blackjackBet').value);
            const resultDiv = document.getElementById('blackjackResult');
            const playerScore = getScore(playerHand);

            // 1. Reveal dealer's second card
            renderHands(false);
            await new Promise(resolve => setTimeout(resolve, 1000)); 

            // 2. Dealer hits until 17 or more
            let dealerScore = getScore(dealerHand);
            while (dealerScore < 17) {
                dealerHand.push(dealCard(blackjackDeck));
                renderHands(false);
                await new Promise(resolve => setTimeout(resolve, 1000));
                dealerScore = getScore(dealerHand);
            }

            // 3. Final scoring
            let message = '';
            let type = '';
            let win = 0;

            if (playerScore > 21) {
                // Already handled by BUST
            } else if (dealerScore > 21) {
                win = bet * 2;
                message = `Dealer <strong>BUSTED</strong> (${dealerScore})! You win ${bet} Credits! Total: ${win.toLocaleString()}`;
                type = 'win';
            } else if (playerScore > dealerScore) {
                win = bet * 2;
                message = `You win! (${playerScore} to ${dealerScore}). Total: ${win.toLocaleString()}`;
                type = 'win';
            } else if (playerScore < dealerScore) {
                message = `Dealer wins (${dealerScore} to ${playerScore}). You lose.`;
                type = 'lose';
            } else {
                win = bet;
                message = `<strong>PUSH</strong> (${playerScore} to ${dealerScore}). Bet returned.`;
                type = 'push';
            }
            
            updateBalance(win);
            showResult(resultDiv, message, type);
            disableButtons(false);
            document.getElementById('dealButton').disabled = false;
        }

        // --- 2. SLOT MACHINE LOGIC ---
        const slotSymbols = ['üçí', 'üçã', 'üîî', 'üí∞', 'üíé']; 
        
        async function playSlots() {
            const betInput = document.getElementById('slotBet');
            const bet = parseInt(betInput.value);
            const resultDiv = document.getElementById('slotResult');
            const reelContainers = [document.getElementById('reel1'), document.getElementById('reel2'), document.getElementById('reel3')];
            const reels = reelContainers.map(c => c.querySelector('.slot-symbol'));

            if (bet > balance || bet <= 0) {
                showResult(resultDiv, 'Invalid bet or insufficient balance!', 'lose');
                return;
            }
            disableButtons(true);
            updateBalance(-bet);

            // START ANIMATION: Apply the 'spinning' class to start CSS animation
            reelContainers.forEach(container => container.classList.add('spinning'));

            const results = [
                slotSymbols[Math.floor(Math.random() * slotSymbols.length)],
                slotSymbols[Math.floor(Math.random() * slotSymbols.length)],
                slotSymbols[Math.floor(Math.random() * slotSymbols.length)]
            ];

            // STOP REEL 1
            await new Promise(resolve => setTimeout(resolve, 500));
            reelContainers[0].classList.remove('spinning');
            reels[0].textContent = results[0];

            // STOP REEL 2
            await new Promise(resolve => setTimeout(resolve, 500));
            reelContainers[1].classList.remove('spinning');
            reels[1].textContent = results[1];

            // STOP REEL 3
            await new Promise(resolve => setTimeout(resolve, 500));
            reelContainers[2].classList.remove('spinning');
            reels[2].textContent = results[2];

            let win = 0;
            let message = `You spun: ${results.join(' | ')}. You lost!`;
            let type = 'lose';

            if (results[0] === results[1] && results[1] === results[2]) {
                win = bet * 15;
                message = `üéâ <strong>JACKPOT!</strong> THREE ${results[0]}'s! You won <strong>${win.toLocaleString()}</strong> Credits!`;
                type = 'win';
            } else if (results[0] === results[1] || results[0] === results[2] || results[1] === results[2]) {
                win = bet * 3;
                message = `Double Match! You won <strong>${win.toLocaleString()}</strong> Credits!`;
                type = 'win';
            }

            updateBalance(win);
            showResult(resultDiv, message, type);
            disableButtons(false);
            document.getElementById('dealButton').disabled = false;
        }

        // --- 3. ROULETTE LOGIC (Using CSS Animation) ---
        const redNumbers = [1, 2, 3, 4, 5, 6];
        const blackNumbers = [7, 8, 9, 10, 11, 12];
        const rouletteSegments = [];
        for (let i = 1; i <= 12; i++) {
            rouletteSegments.push({
                number: i,
                color: redNumbers.includes(i) ? 'RED' : 'BLACK',
                class: redNumbers.includes(i) ? 'red-bg' : 'black-bg'
            });
        }
        
        function buildRouletteReel() {
            const reelContent = document.getElementById('rouletteReelContent');
            const segmentsToDisplay = [...rouletteSegments, ...rouletteSegments, ...rouletteSegments]; 
            
            reelContent.innerHTML = '';
            reelContent.style.transform = `translateY(0)`; 

            segmentsToDisplay.forEach(segment => {
                const div = document.createElement('div');
                div.className = `reel-segment ${segment.class}`;
                div.textContent = segment.number;
                reelContent.appendChild(div);
            });
        }

        async function playRoulette() {
            const betInput = document.getElementById('rouletteBet');
            const bet = parseInt(betInput.value);
            const selection = document.getElementById('rouletteSelection').value;
            const outputSpan = document.getElementById('rouletteOutput');
            const reelContent = document.getElementById('rouletteReelContent');
            const resultDiv = document.getElementById('rouletteResult');

            if (bet > balance || bet <= 0) {
                showResult(resultDiv, 'Invalid bet or insufficient balance!', 'lose');
                return;
            }
            disableButtons(true);
            updateBalance(-bet);

            outputSpan.textContent = "Spinning...";
            
            // 1. Start the visual spin animation
            buildRouletteReel();
            reelContent.classList.add('spinning-effect');
            
            await new Promise(resolve => setTimeout(resolve, 3000)); // Spin for 3 seconds

            // 2. Stop the animation and determine the result
            reelContent.classList.remove('spinning-effect');

            const resultNumber = Math.floor(Math.random() * 12) + 1; 
            const finalSegment = rouletteSegments.find(s => s.number === resultNumber);

            const winningIndex = rouletteSegments.findIndex(s => s.number === resultNumber);
            
            const segmentHeight = 50; 
            const stopPositionIndex = 12 + winningIndex; 
            const finalStopY = -(stopPositionIndex * segmentHeight); 

            // Apply the final stop position
            reelContent.style.transform = `translateY(${finalStopY}px)`;


            // 3. Final scoring (after a brief delay for the visual stop)
            await new Promise(resolve => setTimeout(resolve, 800)); 

            outputSpan.textContent = `Landed on ${finalSegment.number} (${finalSegment.color})`;


            let win = 0;
            let message = `The number is ${finalSegment.number} (${finalSegment.color}). You lost.`;
            let type = 'lose';

            let isWin = false;
            let payout = 2; 

            if (selection === 'red' && finalSegment.color === 'RED') {
                isWin = true;
            } else if (selection === 'black' && finalSegment.color === 'BLACK') {
                isWin = true;
            } else if (selection === 'odd' && resultNumber % 2 !== 0) {
                isWin = true;
            } else if (selection === 'even' && resultNumber % 2 === 0) {
                isWin = true;
            } else if (resultNumber.toString() === selection) { 
                isWin = true;
                payout = 10;
            }

            if (isWin) {
                win = bet * payout;
                message = `The number is ${finalSegment.number} (${finalSegment.color}). üèÜ You <strong>win ${payout}x!</strong> Total: <strong>${win.toLocaleString()}</strong> Credits.`;
                type = 'win';
            } 

            updateBalance(win);
            showResult(resultDiv, message, type);
            disableButtons(false);
            document.getElementById('dealButton').disabled = false;
        }

        // --- 4. POKER LOGIC ---

        const pokerRanks = {
            'Straight Flush': 8,
            'Four of a Kind': 7,
            'Full House': 6,
            'Flush': 5,
            'Straight': 4,
            'Three of a Kind': 3,
            'Two Pair': 2,
            'Pair': 1,
            'High Card': 0
        };

        /**
         * Analyzes the 5-card hand and returns its rank name and value.
         * @param {Array} hand - The 5-card hand.
         * @returns {{rank: string, value: number, kickers: Array}}
         */
        function getHandRank(hand) {
            // Sort by numerical rank (Aces high = 14)
            hand.sort((a, b) => a.rank - b.rank); 
            
            // Group card values and suits
            const values = hand.map(c => c.rank);
            const suits = hand.map(c => c.suit);
            const valueCounts = {};
            const suitCounts = {};
            
            for (const card of hand) {
                valueCounts[card.rank] = (valueCounts[card.rank] || 0) + 1;
                suitCounts[card.suit] = (suitCounts[card.suit] || 0) + 1;
            }

            const counts = Object.values(valueCounts).sort((a, b) => b - a);
            const distinctValues = Object.keys(valueCounts).map(Number).sort((a, b) => b - a);

            // --- Check for Flush ---
            const isFlush = Object.values(suitCounts).some(count => count >= 5);

            // --- Check for Straight ---
            let isStraight = false;
            if (distinctValues.length >= 5) {
                // Check normal straight: 5 consecutive ranks
                if (distinctValues[0] - distinctValues[4] === 4) {
                    isStraight = true;
                }
                // Check A-2-3-4-5 (Ace is 1 for this straight, ranks: 14, 5, 4, 3, 2)
                else if (distinctValues.includes(14) && distinctValues.includes(5) && distinctValues.includes(4) && distinctValues.includes(3) && distinctValues.includes(2)) {
                    isStraight = true;
                }
            }

            // --- Determine Hand Rank ---
            let rank = 'High Card';
            let rankValue = pokerRanks[rank];
            
            if (isStraight && isFlush) {
                rank = 'Straight Flush';
                rankValue = pokerRanks[rank];
            } else if (counts[0] === 4) {
                rank = 'Four of a Kind';
                rankValue = pokerRanks[rank];
            } else if (counts[0] === 3 && counts[1] === 2) {
                rank = 'Full House';
                rankValue = pokerRanks[rank];
            } else if (isFlush) {
                rank = 'Flush';
                rankValue = pokerRanks[rank];
            } else if (isStraight) {
                rank = 'Straight';
                rankValue = pokerRanks[rank];
            } else if (counts[0] === 3) {
                rank = 'Three of a Kind';
                rankValue = pokerRanks[rank];
            } else if (counts[0] === 2 && counts[1] === 2) {
                rank = 'Two Pair';
                rankValue = pokerRanks[rank];
            } else if (counts[0] === 2) {
                rank = 'Pair';
                rankValue = pokerRanks[rank];
            }

            return { rank, value: rankValue, handValues: values };
        }

        /**
         * Determines the winner of two hands with the same rank (Head-to-Head Comparison).
         * This function is simplified and relies on comparing the highest card in the hand's value array.
         * For a full poker engine, this needs to be more complex (comparing pairs, kickers, etc.).
         */
        function compareHands(playerHandRank, dealerHandRank) {
            // First, compare hand rank value (e.g., Straight beats Three of a Kind)
            if (playerHandRank.value > dealerHandRank.value) return 1; // Player wins
            if (playerHandRank.value < dealerHandRank.value) return -1; // Dealer wins

            // Second, compare highest card (simplified tie-breaker)
            // Note: Since all ranks are unique, we just need to compare the array of card ranks.
            for (let i = playerHandRank.handValues.length - 1; i >= 0; i--) {
                if (playerHandRank.handValues[i] > dealerHandRank.handValues[i]) return 1;
                if (playerHandRank.handValues[i] < dealerHandRank.handValues[i]) return -1;
            }

            return 0; // Push
        }

        async function playPoker() {
            const betInput = document.getElementById('pokerBet');
            const bet = parseInt(betInput.value);
            const resultDiv = document.getElementById('pokerResult');
            const playerHandDiv = document.getElementById('playerPokerHand');
            const dealerHandDiv = document.getElementById('dealerPokerHand');

            if (bet > balance || bet <= 0) {
                showResult(resultDiv, 'Invalid bet or insufficient balance!', 'lose');
                return;
            }
            disableButtons(true);
            updateBalance(-bet);

            playerHandDiv.innerHTML = '<span class="hand-label">Your Hand</span>: ';
            dealerHandDiv.innerHTML = '<span class="hand-label">Dealer Hand</span>: ';
            
            let pokerDeck = createDeck();
            const playerHand = [];
            const dealerHand = [];
            
            // Deal Player Cards
            for (let i = 0; i < 5; i++) {
                 playerHand.push(dealCard(pokerDeck));
                const pCard = document.createElement('span');
                pCard.className = 'card';
                pCard.style.color = (playerHand[i].suit === '‚ô•Ô∏è' || playerHand[i].suit === '‚ô¶Ô∏è') ? 'red' : 'black';
                pCard.textContent = `${playerHand[i].value}${playerHand[i].suit}`;
                playerHandDiv.appendChild(pCard);
                await new Promise(resolve => setTimeout(resolve, 150)); 
                pCard.classList.add('dealt');
            }
            await new Promise(resolve => setTimeout(resolve, 500)); 

            // Deal Dealer Cards
            for (let i = 0; i < 5; i++) {
                dealerHand.push(dealCard(pokerDeck));
                const dCard = document.createElement('span');
                dCard.className = 'card';
                dCard.style.color = (dealerHand[i].suit === '‚ô•Ô∏è' || dealerHand[i].suit === '‚ô¶Ô∏è') ? 'red' : 'black';
                dCard.textContent = `${dealerHand[i].value}${dealerHand[i].suit}`;
                dealerHandDiv.appendChild(dCard);
                await new Promise(resolve => setTimeout(resolve, 150)); 
                dCard.classList.add('dealt');
            }
            await new Promise(resolve => setTimeout(resolve, 700)); 

            // --- Hand Ranking & Payout ---
            const playerRank = getHandRank(playerHand);
            const dealerRank = getHandRank(dealerHand);

            const result = compareHands(playerRank, dealerRank);

            let win = 0;
            let message = '';
            let type = 'lose';

            // Payouts based on your rank winning
            const payoutTable = {
                'Pair': 2,
                'Two Pair': 3,
                'Three of a Kind': 4,
                'Straight': 5,
                'Flush': 6,
                'Full House': 8,
                'Four of a Kind': 10,
                'Straight Flush': 20
            };

            const playerPayout = payoutTable[playerRank.rank] || 1; // Default Payout

            if (result === 1) { // Player Wins
                win = bet * playerPayout;
                message = `‚úÖ You win! Your **${playerRank.rank}** beat the Dealer's ${dealerRank.rank}. You won <strong>${win.toLocaleString()}</strong> Credits!`;
                type = 'win';
            } else if (result === 0) { // Push
                win = bet;
                message = `ü§ù It's a <strong>PUSH</strong>! Both hands tied with **${playerRank.rank}**. Bet returned.`;
                type = 'push';
            } else { // Dealer Wins (-1)
                 message = `Dealer wins! Your ${playerRank.rank} was beaten by the Dealer's **${dealerRank.rank}**. You lost.`;
                type = 'lose';
            }

            updateBalance(win);
            showResult(resultDiv, message, type);
            disableButtons(false);
            document.getElementById('dealButton').disabled = false;
        }

        // Initialize roulette reel and balance on load
        buildRouletteReel();
        updateBalance(0); 
    </script>

</body>
</html>